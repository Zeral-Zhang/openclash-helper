<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>é…ç½®</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 24px;
      color: #111827;
      margin-bottom: 8px;
    }
    h2 {
      font-size: 18px;
      color: #111827;
      margin-bottom: 16px;
    }
    h3 {
      font-size: 16px;
      color: #374151;
      margin-bottom: 12px;
    }
    .subtitle {
      color: #6b7280;
      font-size: 14px;
      margin-bottom: 32px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      transition: all 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .password-wrapper {
      position: relative;
    }
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #6b7280;
      cursor: pointer;
      font-size: 20px;
      padding: 4px;
    }
    .btn-group {
      display: flex;
      gap: 12px;
    }
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #667eea;
      color: white;
      flex: 1;
    }
    .btn-primary:hover {
      background: #5568d3;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
      flex: 1;
    }
    .btn-secondary:hover {
      background: #d1d5db;
    }
    .status {
      margin-top: 12px;
      padding: 12px 16px;
      border-radius: 6px;
      font-size: 14px;
      display: none;
    }
    .status.success {
      background: #d1fae5;
      color: #065f46;
      border-left: 3px solid #10b981;
      display: block;
    }
    .status.error {
      background: #fee2e2;
      color: #991b1b;
      border-left: 3px solid #ef4444;
      display: block;
    }
    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
    .section {
      margin-bottom: 32px;
    }
    hr {
      border: none;
      border-top: 1px solid #e5e7eb;
      margin: 32px 0;
    }
    /* æµ®æ¡†æ ·å¼ */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 80vh;
      overflow-y: auto;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #6b7280;
      padding: 0;
    }
    .step {
      margin-bottom: 20px;
      padding: 16px;
      background: #f9fafb;
      border-radius: 8px;
    }
    .step-title {
      font-weight: 600;
      color: #111827;
      margin-bottom: 8px;
    }
    .step-content {
      font-size: 14px;
      color: #374151;
      line-height: 1.6;
    }
    .code-block {
      background: #1f2937;
      color: #e5e7eb;
      padding: 12px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin: 8px 0;
      position: relative;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #374151;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }
    .copy-btn:hover {
      background: #4b5563;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>é…ç½®</h1>
    <p class="subtitle">é…ç½® OpenClash è§„åˆ™åŠ©æ‰‹</p>
    
    <!-- é€‰æ‹©æ¨¡å¼ -->
    <div class="section">
      <label>åŒæ­¥æ¨¡å¼</label>
      <select id="syncMode">
        <option value="cloudflare">äº‘ç«¯åŒæ­¥ï¼ˆæ¨è - æ”¯æŒå¤šè®¾å¤‡ï¼‰</option>
        <option value="remote">è¿œç¨‹åŒæ­¥ï¼ˆä»…è·¯ç”±å™¨ï¼‰</option>
      </select>
      <div class="hint">äº‘ç«¯åŒæ­¥æ”¯æŒå®¶é‡Œ OpenClash + å…¬å¸ Clash Verge</div>
    </div>
    
    <hr>
    
    <!-- äº‘ç«¯åŒæ­¥é…ç½® -->
    <div id="cloudflareConfig">
      <h2>Cloudflare Worker é…ç½®</h2>
      <p class="subtitle" style="margin-bottom: 16px;">
        <a href="#" id="showTutorial" style="color: #667eea;">ğŸ“– æŸ¥çœ‹éƒ¨ç½²æ•™ç¨‹</a>
      </p>
      
      <div class="form-group">
        <label>Worker URL</label>
        <input type="text" id="workerUrl" placeholder="https://your-worker.workers.dev">
        <div class="hint">Cloudflare Worker çš„å®Œæ•´ URL</div>
      </div>
      
      <div class="form-group">
        <label>API Secret</label>
        <div class="password-wrapper">
          <input type="password" id="apiSecret" placeholder="è¾“å…¥ API å¯†é’¥">
          <button type="button" class="password-toggle" id="toggleApiSecret">ğŸ‘ï¸</button>
        </div>
        <div class="hint">Worker ä¸­è®¾ç½®çš„ API_SECRET ç¯å¢ƒå˜é‡</div>
      </div>
      
      <button class="btn-secondary" id="testCloudflare">æµ‹è¯•è¿æ¥</button>
      <div id="statusCloudflare" class="status"></div>
      
      <hr>
      
      <h2>OpenClash è‡ªåŠ¨é…ç½®ï¼ˆå¯é€‰ï¼‰</h2>
      <p class="subtitle" style="margin-bottom: 16px;">å¡«å†™è·¯ç”±å™¨ä¿¡æ¯åå¯ä¸€é”®é…ç½® UCI</p>
      
      <div class="form-group">
        <label>è·¯ç”±å™¨åœ°å€</label>
        <input type="text" id="hostCf" placeholder="192.168.1.1">
      </div>
      
      <div class="form-group">
        <label>ç”¨æˆ·å</label>
        <input type="text" id="usernameCf" placeholder="root" value="root">
      </div>
      
      <div class="form-group">
        <label>å¯†ç </label>
        <div class="password-wrapper">
          <input type="password" id="passwordCf" placeholder="è·¯ç”±å™¨å¯†ç ">
          <button type="button" class="password-toggle" id="togglePasswordCf">ğŸ‘ï¸</button>
        </div>
      </div>
      
      <div class="btn-group">
        <button class="btn-secondary" id="testCf">æµ‹è¯•è¿æ¥</button>
        <button class="btn-secondary" id="fetchGroupsCf">è·å–ä»£ç†ç»„</button>
      </div>
      <div id="statusCf" class="status"></div>
      
      <div class="form-group" style="margin-top: 16px;">
        <label>ä»£ç†ç»„</label>
        <select id="cfProxyGroup" disabled>
          <option value="">è¯·å…ˆè·å–ä»£ç†ç»„åˆ—è¡¨</option>
        </select>
        <div class="hint">é€‰æ‹©è§„åˆ™åŒ¹é…åä½¿ç”¨çš„ä»£ç†ç»„</div>
      </div>
      
      <button class="btn-primary" id="autoConfigCf" disabled>è‡ªåŠ¨é…ç½® UCI</button>
      <div id="statusAutoConfigCf" class="status"></div>
      
      <hr>
      
      <h3>OpenClash å¤–éƒ¨æ§åˆ¶</h3>
      
      <div class="form-group">
        <label>å¤–éƒ¨æ§åˆ¶ç«¯å£</label>
        <input type="number" id="clashPortCf" placeholder="9090" value="9090">
      </div>
      
      <div class="form-group">
        <label>Secretï¼ˆå¯†é’¥ï¼‰</label>
        <div class="password-wrapper">
          <input type="password" id="clashSecretCf" placeholder="è‡ªåŠ¨è·å–æˆ–æ‰‹åŠ¨å¡«å†™">
          <button type="button" class="password-toggle" id="toggleSecretCf">ğŸ‘ï¸</button>
        </div>
      </div>
      
      <div class="form-group">
        <label>æ§åˆ¶é¢æ¿ UI</label>
        <select id="clashUICf">
          <option value="zashboard">Zashboardï¼ˆæ¨èï¼‰</option>
          <option value="dashboard">Dashboard</option>
          <option value="yacd">Yacd</option>
          <option value="razord">Razord</option>
        </select>
      </div>

      <button class="btn-secondary" id="testClashApiCf">æµ‹è¯• Clash API è¿æ¥</button>
      <div id="statusClashApiCf" class="status"></div>

      <hr>
      
      <h3>Clash Verge é…ç½®</h3>
      <div class="hint" style="margin-bottom: 12px;">å¤åˆ¶ä»¥ä¸‹é…ç½®åˆ° Clash Verge â†’ é…ç½® â†’ å…¨å±€æ‰©å±•é…ç½®</div>
      <textarea id="clashVergeMerge" readonly style="
        height: 200px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        background: #f9fafb;
        resize: vertical;
      "></textarea>
      <button class="btn-secondary" id="copyClashVergeMerge" style="margin-top: 8px;">å¤åˆ¶é…ç½®</button>
    </div>
    
    <!-- è¿œç¨‹åŒæ­¥é…ç½® -->
    <div id="remoteConfig" style="display:none;">
      <h2>è·¯ç”±å™¨é…ç½®</h2>
      
      <div class="form-group">
        <label>è·¯ç”±å™¨åœ°å€</label>
        <input type="text" id="host" placeholder="192.168.1.1 æˆ– 192.168.1.1:8080">
        <div class="hint">æ”¯æŒ IP:ç«¯å£ æ ¼å¼</div>
      </div>
      
      <div class="form-group">
        <label>ç”¨æˆ·å</label>
        <input type="text" id="username" placeholder="root" value="root">
      </div>
      
      <div class="form-group">
        <label>å¯†ç </label>
        <div class="password-wrapper">
          <input type="password" id="password" placeholder="è·¯ç”±å™¨å¯†ç ">
          <button type="button" class="password-toggle" id="togglePassword">ğŸ‘ï¸</button>
        </div>
      </div>
      
      <div class="form-group">
        <label>ä»£ç†è§„åˆ™æ–‡ä»¶è·¯å¾„</label>
        <input type="text" id="proxyFile" placeholder="/etc/openclash/rule_provider/Custom_Proxy.yaml">
      </div>
      
      <div class="form-group">
        <label>ç›´è¿è§„åˆ™æ–‡ä»¶è·¯å¾„</label>
        <input type="text" id="directFile" placeholder="/etc/openclash/rule_provider/Custom_Direct.yaml">
      </div>
      
      <button class="btn-secondary" id="testRemote">æµ‹è¯•è¿æ¥</button>
      <div id="statusRemote" class="status"></div>
      
      <hr>
      
      <h2>OpenClash å¤–éƒ¨æ§åˆ¶</h2>
      
      <div class="form-group">
        <label>å¤–éƒ¨æ§åˆ¶ç«¯å£</label>
        <input type="number" id="clashPort" placeholder="9090" value="9090">
        <div class="hint">OpenClash å¤–éƒ¨æ§åˆ¶ç«¯å£ï¼Œé»˜è®¤ 9090</div>
      </div>
      
      <div class="form-group">
        <label>Secretï¼ˆå¯†é’¥ï¼‰</label>
        <div class="password-wrapper">
          <input type="password" id="clashSecret" placeholder="ç•™ç©ºè¡¨ç¤ºæ— å¯†ç ">
          <button type="button" class="password-toggle" id="toggleSecret">ğŸ‘ï¸</button>
        </div>
        <div class="hint">OpenClash å¤–éƒ¨æ§åˆ¶å¯†é’¥</div>
      </div>
      
      <div class="form-group">
        <label>æ§åˆ¶é¢æ¿ UI</label>
        <select id="clashUI">
          <option value="zashboard">Zashboardï¼ˆæ¨èï¼‰</option>
          <option value="dashboard">Dashboard</option>
          <option value="yacd">Yacd</option>
          <option value="razord">Razord</option>
        </select>
      </div>

      <button class="btn-secondary" id="testClashApi">æµ‹è¯• Clash API è¿æ¥</button>
      <div id="statusClashApi" class="status"></div>

      <hr>
      
      <h2>è‡ªåŠ¨é…ç½® OpenClash</h2>
      <p class="subtitle" style="margin-bottom: 16px;">è‡ªåŠ¨é…ç½® UCI è§„åˆ™æä¾›è€…ï¼Œéœ€è¦å…ˆæµ‹è¯•è¿æ¥æˆåŠŸ</p>
      
      <div class="form-group">
        <label>ä»£ç†ç»„</label>
        <select id="proxyGroup" disabled>
          <option value="">è¯·å…ˆè·å–ä»£ç†ç»„åˆ—è¡¨</option>
        </select>
        <div class="hint">é€‰æ‹©è§„åˆ™åŒ¹é…åä½¿ç”¨çš„ä»£ç†ç»„</div>
      </div>
      
      <div class="btn-group">
        <button class="btn-secondary" id="fetchGroups">è·å–ä»£ç†ç»„</button>
        <button class="btn-primary" id="autoConfigRemote" disabled>è‡ªåŠ¨é…ç½® UCI</button>
      </div>
      <div id="statusAutoConfig" class="status"></div>
    </div>
    
    <hr>
    
    <button class="btn-primary" id="save" style="width: 100%;">ä¿å­˜æ‰€æœ‰é…ç½®</button>
    <div id="statusSave" class="status"></div>
  </div>
  
  <!-- éƒ¨ç½²æ•™ç¨‹æµ®æ¡† -->
  <div class="modal-overlay" id="tutorialModal">
    <div class="modal">
      <div class="modal-header">
        <h2>Cloudflare Worker éƒ¨ç½²æ•™ç¨‹</h2>
        <button class="modal-close" id="closeTutorial">Ã—</button>
      </div>
      
      <div class="step">
        <div class="step-title">1. æ³¨å†Œ Cloudflare è´¦å·</div>
        <div class="step-content">
          è®¿é—® <a href="https://dash.cloudflare.com/sign-up" target="_blank">dash.cloudflare.com</a> æ³¨å†Œå…è´¹è´¦å·
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">2. åˆ›å»º KV å‘½åç©ºé—´</div>
        <div class="step-content">
          Workers & Pages â†’ KV â†’ Create a namespace â†’ å‘½åä¸º <code>RULES</code>
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">3. åˆ›å»º Worker</div>
        <div class="step-content">
          Workers & Pages â†’ Create application â†’ Create Worker â†’ å‘½ååç‚¹å‡» Deploy â†’ Edit code
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">4. ç²˜è´´ Worker ä»£ç </div>
        <div class="step-content">
          åˆ é™¤ç¼–è¾‘å™¨ä¸­æ‰€æœ‰ä»£ç ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹ï¼Œç‚¹å‡» Save and Deploy
          <div class="code-block" id="workerCode"></div>
          <button class="btn-secondary" id="copyWorkerCode" style="margin-top: 8px;">ğŸ“‹ å¤åˆ¶ä»£ç </button>
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">5. ç»‘å®š KV</div>
        <div class="step-content">
          ç‚¹å‡»ä¸Šæ–¹ <code>Bindings</code> æ ‡ç­¾é¡µ â†’ Add binding â†’ ä»å·¦ä¾§åˆ—è¡¨é€‰æ‹© <code>KV Namespace</code><br>
          Variable name: <code>RULES</code>ï¼Œé€‰æ‹©åˆšåˆ›å»ºçš„å‘½åç©ºé—´ï¼Œç‚¹å‡» Deploy
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">6. è®¾ç½® API Secret</div>
        <div class="step-content">
          ç‚¹å‡»ä¸Šæ–¹ <code>Settings</code> æ ‡ç­¾é¡µ â†’ Variables and Secrets â†’ Add<br>
          Variable name: <code>API_SECRET</code>ï¼ŒValue: è®¾ç½®ä¸€ä¸ªå¯†ç ï¼Œå‹¾é€‰ Encryptï¼Œç‚¹å‡» Deploy
        </div>
      </div>
      
      <div class="step">
        <div class="step-title">7. è·å– Worker URL</div>
        <div class="step-content">
          è¿”å› Worker è¯¦æƒ…é¡µï¼Œå¤åˆ¶ Preview ä¸‹æ–¹çš„ URLï¼ˆå¦‚ <code>https://xxx.workers.dev</code>ï¼‰
        </div>
      </div>
      
      <button class="btn-primary" id="closeTutorialBtn" style="width: 100%; margin-top: 16px;">å®Œæˆ</button>
    </div>
  </div>
  
  <script src="api.js"></script>
  <script src="cloudflare-api.js"></script>
  <script src="config-new.js"></script>
</body>
</html>
